from sklearn.preprocessing import StandardScaler
from sklearn.cluster import KMeans

# Scaling
X = features[['Total_Spend','Orders','Quantity','Recency','Avg_Basket']]
X_scaled = StandardScaler().fit_transform(X)

# K-Means
kmeans = KMeans(n_clusters=4, random_state=0)
features['Cluster'] = kmeans.fit_predict(X_scaled)

# Agglomerative
agg = AgglomerativeClustering(n_clusters=4, linkage='ward')
labels_agg = agg.fit_predict(X_scaled)

# GMM
gmm = GaussianMixture(n_components=4, random_state=0)
labels_gmm = gmm.fit_predict(X_scaled)

# Isolation Forest
iso = IsolationForest(random_state=0, contamination=0.02)
features['Anomaly'] = iso.fit_predict(X_scaled)
top20 = features[features['Anomaly']==-1].head(20)

